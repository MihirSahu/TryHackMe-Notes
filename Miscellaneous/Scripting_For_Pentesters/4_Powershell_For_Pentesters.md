## Powershell for Pentesters


- It's important to know how to use powershell when exploiting a Windows system
- Powershell enumeration scripts like PowerView and Nishang are useful but are detected by AV

## Manipulating Files
- `Start-Process` can start a process
	- `Start-Process notepad.exe`
- `Get-Process`
	- `Get-Process -Name notepad`
- `Get-Content`
	- `Get-Content IP_Addresses.txt`
- `Copy-Item` and `Move-Item`
- `Get-FileHash`
	- `Get-FileHash -Algorithm SHA256 IP_Addresses.txt`

## Downloading Files
- ExecutionPolity - a feature that acts as a safety measure to alert the user about files downloaded from the internet
	- View configuration with `Get-ExecutionPolicy -list`
	- Can have 7 different values
	```
	AllSigned: Scripts can run but require all scripts to be signed by a trusted publisher.
	Bypass: All scripts can run, and no warnings or prompts will be displayed.
	Default: This refers to “restricted” for Windows clients and “RemoteSigned” for Windows servers.
	RemoteSigned: Scripts can run, and this does not require local scripts to be digitally signed.
	Restricted: The default configuration for Windows clients. Allows individual commands to run, does not allow scripts.
	Undefined: This shows that no specific execution policy was set. This means default execution policies will be enforced.
	Unrestricted: Most scripts will run.
	```
	- Bypass
		1. `powershell -ExecutionPolicy Bypass -File <file>`
		2. `Set-ExecutionPolicy Bypass -Scope Process`
- `Invoke-WebRequest`

## System Reconnaissance
- Find Mission Patches
	- `Get-Hotfix`
- `Format-List` can be used to get more information about objects
	- `dir | Format-List`
- `Out-Gridview` provides a GUI with sortable columns
- Exercise
	1. Use `get-hotfix | where-object -Property InstalledOn -eq "5/15/2019"` to get `KB4499728`

## Using Powerview
- Make sure to bypass ExecutionPolicy
- Import powerview with `Import-Module <file>`
